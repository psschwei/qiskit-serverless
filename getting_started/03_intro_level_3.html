<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Getting started - level 3 &#8212; Quantum serverless 0.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../guides/index.html" />
    <link rel="prev" title="Getting started - level 2" href="02_intro_level_2.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Getting-started---level-3">
<h1>Getting started - level 3<a class="headerlink" href="#Getting-started---level-3" title="Permalink to this heading">Â¶</a></h1>
<p>In this tutorial we will explore a little bit more advanced example of a program that require some configuration, requirements setup, etc.</p>
<p>Again we will start with writing code for our program and saving it to <a class="reference external" href="./source_files/gs_level_3.py">./source_files/gs_level_3.py</a> file. This time, our program will run an estimator as a parallel function, computing the expectation value of a single observable over a set of random circuits. The results will be saved to a database, which means it will be stored in a formatted way and later on we can fetch results of or programs without looking at logs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># source_files/gs_level_3.py</span>

<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.random</span> <span class="kn">import</span> <span class="n">random_circuit</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">SparsePauliOp</span>
<span class="kn">from</span> <span class="nn">qiskit.primitives</span> <span class="kn">import</span> <span class="n">Estimator</span>

<span class="kn">from</span> <span class="nn">quantum_serverless</span> <span class="kn">import</span> <span class="n">QuantumServerless</span><span class="p">,</span> <span class="n">distribute_task</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">put</span><span class="p">,</span> <span class="n">save_result</span>

<span class="c1"># 1. let&#39;s annotate out function to convert it</span>
<span class="c1"># to function that can be executed remotely</span>
<span class="c1"># using `distribute_task` decorator</span>
<span class="nd">@distribute_task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">circuit</span><span class="p">:</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">SparsePauliOp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute expectation value of an obs given a circuit&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Estimator</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">circuit</span><span class="p">],</span> <span class="p">[</span><span class="n">obs</span><span class="p">])</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>


<span class="c1"># 2. Next let&#39;s create our serverless object that we will be using to create context</span>
<span class="c1"># which will allow us to run functions in parallel</span>
<span class="n">serverless</span> <span class="o">=</span> <span class="n">QuantumServerless</span><span class="p">()</span>

<span class="n">circuits</span> <span class="o">=</span> <span class="p">[</span><span class="n">random_circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

<span class="c1"># 3. create serverless context which will allow us to run functions in parallel</span>
<span class="k">with</span> <span class="n">serverless</span><span class="o">.</span><span class="n">context</span><span class="p">():</span>
    <span class="c1"># 4. The observable is the same for all expectation value calculations. So we can put that object into remote storage since it will be shared among all executions of my_function.</span>
    <span class="n">obs_ref</span> <span class="o">=</span> <span class="n">put</span><span class="p">(</span><span class="n">SparsePauliOp</span><span class="p">([</span><span class="s2">&quot;ZZ&quot;</span><span class="p">]))</span>

    <span class="c1"># 5. we can run our function for a single input circuit</span>
    <span class="c1"># and get back a reference to it as now our function is a remote one</span>
    <span class="n">function_reference</span> <span class="o">=</span> <span class="n">my_function</span><span class="p">(</span><span class="n">circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obs_ref</span><span class="p">)</span>

    <span class="c1"># 5.1 or we can run N of them in parallel (for all circuits)</span>
    <span class="c1"># note: if we will be using real backends (QPUs) we should either use</span>
    <span class="c1">#       N separate backends to run them in parallel or</span>
    <span class="c1">#       one will be running after each other sequentially</span>
    <span class="n">function_references</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_function</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">obs_ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">circ</span> <span class="ow">in</span> <span class="n">circuits</span><span class="p">]</span>

    <span class="c1"># 6. to get results back from reference</span>
    <span class="c1"># we need to call `get` on function reference</span>
    <span class="n">single_result</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">function_reference</span><span class="p">)</span>
    <span class="n">parallel_result</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">function_references</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Single execution:&quot;</span><span class="p">,</span> <span class="n">single_result</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N parallel executions:&quot;</span><span class="p">,</span> <span class="n">parallel_result</span><span class="p">)</span>

    <span class="c1"># 6.1 (Optional) write results to db.</span>
    <span class="n">save_result</span><span class="p">({</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span>
        <span class="s2">&quot;single&quot;</span><span class="p">:</span> <span class="n">single_result</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="s2">&quot;parallel_result&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">parallel_result</span><span class="p">]</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>As you can see we move to advanced section of using serverless.</p>
<p>Here we are using <code class="docutils literal notranslate"><span class="pre">ditribute_task</span></code> decorator to convert our function to asynchronous distributed one. With that <code class="docutils literal notranslate"><span class="pre">my_function</span></code> is converted into asynchronous distributed function (as a result you will be getting function pointer), which means that the function no longer executes as part of your local python process, but executed on configured compute resources.</p>
<p>Moreover, we are using <code class="docutils literal notranslate"><span class="pre">save_result</span></code> function in order to save results into database storage, so we can retrieve it later after program execution.</p>
<p>Next we need to run this program. For that we need to import necessary modules and configure QuantumServerless client. We are doing so by providing name and host for deployed infrastructure.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quantum_serverless</span> <span class="kn">import</span> <span class="n">QuantumServerless</span><span class="p">,</span> <span class="n">GatewayProvider</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provider</span> <span class="o">=</span> <span class="n">GatewayProvider</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="c1"># this username has already been defined in local docker setup and does not need to be changed</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password123&quot;</span><span class="p">,</span> <span class="c1"># this password has already been defined in local docker setup and does not need to be changed</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;http://gateway:8000&quot;</span><span class="p">,</span> <span class="c1"># address of provider</span>
<span class="p">)</span>

<span class="n">serverless</span> <span class="o">=</span> <span class="n">QuantumServerless</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<span class="n">serverless</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;QuantumServerless | providers [gateway-provider]&gt;
</pre></div></div>
</div>
<p>Run program</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quantum_serverless</span> <span class="kn">import</span> <span class="n">Program</span>

<span class="n">program</span> <span class="o">=</span> <span class="n">Program</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Advanced program&quot;</span><span class="p">,</span>
    <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&quot;gs_level_3.py&quot;</span><span class="p">,</span>
    <span class="n">working_dir</span><span class="o">=</span><span class="s2">&quot;./source_files/&quot;</span>
<span class="p">)</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">serverless</span><span class="o">.</span><span class="n">run_program</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
<span class="n">job</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Job | 65dadf22-16d5-40e2-9a3e-de460e439c34&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;SUCCEEDED&#39;
</pre></div></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">job.result()</span></code> we can get saved results inside of our function back. <code class="docutils literal notranslate"><span class="pre">.result()</span></code> call will return you whatever you passed in <code class="docutils literal notranslate"><span class="pre">save_result</span></code> inside the program file, while <code class="docutils literal notranslate"><span class="pre">.logs()</span></code> will return everything that was logged by job (stdio, e.g prints).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;{&#34;status&#34;: &#34;ok&#34;, &#34;single&#34;: [1.0], &#34;parallel_result&#34;: [[1.0], [1.0], [1.0]]}&#39;
</pre></div></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Quantum serverless</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_intro_level_1.html">Getting started - level 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_intro_level_2.html">Getting started - level 2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started - level 3</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/01_run_anything_in_distributed_fashion.html">Guide: run anything in distributed fashion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/02_specific_resource_allocation.html">Guide: specific resource requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/03_runtime_primitives_with_quantum_serverless.html">Guide: Qiskit Runtime Primitives with QuantumServerless</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/03_specific_package_installation.html">Guide: specific package requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/04_run_programs.html">Guide: run async programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/05_get_finished_tasks.html">Guide: get finished remote tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/06_shared_state.html">Guide: state handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/07_working_with_datasets.html">Guide: working with large datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/08_multi_cloud_deployment.html">Guide: multi cloud deployment</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/01_quantum_serverless.html">Tutorial: Overview of Quantum Serverless</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/02_tutorial_-_approaches_to_serverless_code_writing.html">Tutorial: approaches to serverless code writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/03_tutorial_writing_serverless_pacakge_from_scratch.html">Tutorial: writing serverless package from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/04_tutorial_-_converting_existing_code_to_serverless.html">Tutorial: converting existing code to serverless without internal code modifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/06_electronic_structure_problem.html">Tutorial: solving electronic structure problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/07_benchmark_program.html">Tutorial: benchmark program to stress test compute resources</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidocs/index.html">API References</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="02_intro_level_2.html" title="previous chapter">Getting started - level 2</a></li>
      <li>Next: <a href="../guides/index.html" title="next chapter">&lt;no title&gt;</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/getting_started/03_intro_level_3.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>